<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAET LMS - Principles of Electricity Module</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #00ff41;
            font-family: 'Share Tech Mono', monospace;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* CRT Effect Container */
        .crt-container {
            position: relative;
            min-height: 100vh;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a0a 100%);
        }

        /* Scanlines */
        .crt-container::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%,
                rgba(0, 255, 65, 0.03) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 1000;
            animation: scanlines 8s linear infinite;
        }

        @keyframes scanlines {
            0% { background-position: 0 0; }
            100% { background-position: 0 10px; }
        }

        /* Flicker effect */
        .crt-container::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            pointer-events: none;
            z-index: 999;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.27861; }
            5% { opacity: 0.34769; }
            10% { opacity: 0.23604; }
            15% { opacity: 0.90626; }
            20% { opacity: 0.18128; }
            25% { opacity: 0.83891; }
            30% { opacity: 0.65583; }
            35% { opacity: 0.67807; }
            40% { opacity: 0.26559; }
            45% { opacity: 0.84693; }
            50% { opacity: 0.96019; }
            55% { opacity: 0.08594; }
            60% { opacity: 0.20313; }
            65% { opacity: 0.71988; }
            70% { opacity: 0.53455; }
            75% { opacity: 0.37288; }
            80% { opacity: 0.71428; }
            85% { opacity: 0.70419; }
            90% { opacity: 0.7003; }
            95% { opacity: 0.36108; }
            100% { opacity: 0.24387; }
        }

        /* Hangar Doors */
        .hangar-doors {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5000;
            pointer-events: none;
        }

        .door-left, .door-right {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, #2a2a2a, #1a1a1a);
            box-shadow: inset 0 0 100px rgba(0, 255, 65, 0.1);
            transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
        }

        .door-left {
            left: 0;
            background: linear-gradient(90deg, #1a1a1a, #2a2a2a);
            border-right: 3px solid #00ff41;
        }

        .door-right {
            right: 0;
            background: linear-gradient(90deg, #2a2a2a, #1a1a1a);
            border-left: 3px solid #00ff41;
        }

        .doors-open .door-left {
            transform: translateX(-100%);
        }

        .doors-open .door-right {
            transform: translateX(100%);
        }

        /* Door Text */
        .door-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            color: #00ff41;
            text-shadow: 0 0 20px #00ff41;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Content */
        .main-content {
            position: relative;
            z-index: 10;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header with XP and Badges */
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, transparent 10px, rgba(0, 255, 65, 0.1) 10px, rgba(0, 255, 65, 0.1) calc(100% - 10px), transparent calc(100% - 10px));
            border: 2px solid #00ff41;
            clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .header-left {
            flex: 1;
            min-width: 300px;
        }

        .module-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: #00ff41;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            text-shadow: 0 0 10px #00ff41;
            margin-bottom: 0.5rem;
        }

        .module-subtitle {
            font-size: 1rem;
            color: #ffcc00;
            text-transform: uppercase;
            letter-spacing: 0.3em;
        }

        /* Header Actions Row */
        .header-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        /* NotebookLM Button */
        .notebook-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, rgba(255, 102, 0, 0.2), rgba(255, 204, 0, 0.2));
            border: 2px solid #ff6600;
            color: #ffcc00;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .notebook-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 204, 0, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .notebook-btn:hover::before {
            left: 100%;
        }

        .notebook-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 102, 0, 0.4);
            background: linear-gradient(135deg, rgba(255, 102, 0, 0.3), rgba(255, 204, 0, 0.3));
            border-color: #ffcc00;
            color: #00ff41;
        }

        .notebook-icon {
            font-size: 1.2rem;
        }

        /* XP and Badge Section */
        .header-right {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .xp-tracker {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffcc00;
            padding: 1rem;
            min-width: 200px;
        }

        .xp-label {
            font-size: 0.8rem;
            color: #ffcc00;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .xp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: #00ff41;
        }

        .xp-bar {
            background: rgba(0, 0, 0, 0.8);
            height: 8px;
            margin-top: 0.5rem;
            border: 1px solid #ffcc00;
            position: relative;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffcc00, #ff6600);
            width: 0%;
            transition: width 1s ease;
        }

        .badges-display {
            display: flex;
            gap: 1rem;
        }

        .badge {
            width: 50px;
            height: 50px;
            border: 2px solid #ffcc00;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            position: relative;
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .badge.earned {
            opacity: 1;
            border-color: #00ff41;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
            animation: badge-pulse 2s infinite;
        }

        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .badge-icon {
            font-size: 1.5rem;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: rgba(0, 20, 40, 0.8);
            border: 2px solid #00ff41;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .progress-tracker::before {
            content: "MODULE PROGRESS";
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 0.8rem;
            color: #ffcc00;
            letter-spacing: 0.2em;
        }

        .progress-bar-container {
            margin-top: 2rem;
            background: #0a0a0a;
            height: 30px;
            border: 1px solid #00ff41;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #ffcc00);
            width: 0%;
            transition: width 1s ease;
            position: relative;
            box-shadow: 0 0 20px #00ff41;
        }

        .progress-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .stat {
            color: #ffcc00;
        }

        .stat span {
            color: #00ff41;
            font-weight: bold;
        }

        /* Progress Tracking Info */
        .progress-info {
            background: rgba(255, 204, 0, 0.1);
            border: 1px solid #ffcc00;
            padding: 1rem;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            color: #ffcc00;
        }

        .progress-info h3 {
            color: #00ff41;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .progress-info ul {
            margin-left: 1.5rem;
            line-height: 1.6;
        }

        /* Lessons Grid */
        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        /* Lesson Card - Toned down hover effects */
        .lesson-card {
            background: linear-gradient(135deg, rgba(0, 40, 80, 0.3), rgba(0, 20, 40, 0.3));
            border: 2px solid #00ff41;
            padding: 1.5rem;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            min-height: 280px;
            display: flex;
            flex-direction: column;
        }

        .lesson-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 255, 65, 0.05);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .lesson-card:hover::before {
            opacity: 1;
        }

        .lesson-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 65, 0.2);
            border-color: #00ff99;
        }

        .lesson-number {
            position: absolute;
            top: 10px;
            right: 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            color: rgba(0, 255, 65, 0.2);
            z-index: 1;
        }

        .lesson-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.8rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid;
            font-size: 0.8rem;
            text-transform: uppercase;
            margin-bottom: 1rem;
            width: fit-content;
        }

        .status-locked {
            border-color: #ff3333;
            color: #ff3333;
        }

        .status-available {
            border-color: #ffcc00;
            color: #ffcc00;
            animation: blink 2s infinite;
        }

        .status-in-progress {
            border-color: #ff6600;
            color: #ff6600;
        }

        .status-completed {
            border-color: #00ff41;
            color: #00ff41;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .lesson-icon {
            width: 80px;
            height: 80px;
            margin: 1rem 0;
        }

        .lesson-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ff41;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .lesson-description {
            font-size: 0.9rem;
            color: #8fff9f;
            line-height: 1.4;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .lesson-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid rgba(0, 255, 65, 0.2);
        }

        .lesson-info {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
        }

        .lesson-duration {
            color: #ffcc00;
        }

        .lesson-xp {
            color: #00ff41;
        }

        .lesson-action {
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, #00ff41, #00cc33);
            border: 2px solid #00ff41;
            color: #0a0a0a;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.1em;
        }

        .lesson-action:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
            background: linear-gradient(135deg, #00ff99, #00ff41);
        }

        .lesson-action:disabled {
            background: #333;
            border-color: #666;
            color: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Lesson Modal */
        .lesson-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
        }

        .lesson-modal.active {
            display: block;
        }

        .modal-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 85%;
            background: #0a0a0a;
            border: 3px solid #00ff41;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: linear-gradient(90deg, rgba(0, 255, 65, 0.1), rgba(0, 255, 65, 0.05));
            border-bottom: 2px solid #00ff41;
        }

        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #00ff41;
            text-transform: uppercase;
        }

        .modal-controls {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .lesson-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffcc00;
        }

        .progress-label {
            font-size: 0.9rem;
            color: #ffcc00;
            text-transform: uppercase;
        }

        .progress-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ff41;
        }

        .modal-close {
            padding: 0.6rem 1.2rem;
            background: #ff3333;
            border: 2px solid #ff3333;
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', sans-serif;
        }

        .modal-close:hover {
            background: #ff5555;
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
        }

        .modal-content {
            position: relative;
            height: calc(100% - 70px);
            background: #000;
        }

        .iframe-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: #00ff41;
            text-transform: uppercase;
            animation: pulse 1s infinite;
        }

        .lesson-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #fff;
        }

        /* XP Notification */
        .xp-notification {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            background: linear-gradient(135deg, rgba(0, 255, 65, 0.9), rgba(255, 204, 0, 0.9));
            border: 3px solid #00ff41;
            color: #0a0a0a;
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 3000;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.8);
        }

        @keyframes xp-pop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Circuit Background Pattern */
        .circuit-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            background-image: 
                linear-gradient(90deg, #00ff41 1px, transparent 1px),
                linear-gradient(#00ff41 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .module-title {
                font-size: 1.5rem;
                letter-spacing: 0.1em;
            }

            .lessons-grid {
                grid-template-columns: 1fr;
            }

            .modal-container {
                width: 95%;
                height: 90%;
            }

            .header-right {
                width: 100%;
                justify-content: center;
            }

            .progress-stats {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- XP Notification -->
    <div class="xp-notification" id="xpNotification">
        +<span id="xpAmount">0</span> XP EARNED!
    </div>

    <!-- Hangar Doors Opening Animation -->
    <div class="hangar-doors" id="hangarDoors">
        <div class="door-left">
            <div class="door-text">INITIALIZING...</div>
        </div>
        <div class="door-right">
            <div class="door-text">CAET LMS</div>
        </div>
    </div>

    <!-- Lesson Modal -->
    <div class="lesson-modal" id="lessonModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Loading...</h2>
                <div class="modal-controls">
                    <div class="lesson-progress">
                        <span class="progress-label">Progress:</span>
                        <span class="progress-value" id="lessonProgress">0%</span>
                    </div>
                    <button class="modal-close" onclick="closeLessonModal()">EXIT</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="iframe-loading" id="iframeLoading">LOADING LESSON...</div>
                <iframe class="lesson-iframe" id="lessonFrame" src=""></iframe>
            </div>
        </div>
    </div>

    <!-- CRT Container -->
    <div class="crt-container">
        <!-- Circuit Background -->
        <div class="circuit-bg"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Module Header with XP and Badges -->
            <header class="module-header">
                <div class="header-left">
                    <h1 class="module-title">Principles of Electricity</h1>
                    <p class="module-subtitle">CAET Certification Training</p>
                    <div class="header-actions">
                        <a href="https://notebooklm.google.com" target="_blank" class="notebook-btn">
                            <span class="notebook-icon">üìö</span>
                            <span>Access NotebookLM</span>
                        </a>
                        <a href="dashboard.html" class="notebook-btn" style="border-color: #00ff41; color: #00ff41;">
                            <span class="notebook-icon">üìä</span>
                            <span>View Dashboard</span>
                        </a>
                    </div>
                </div>
                <div class="header-right">
                    <div class="xp-tracker">
                        <div class="xp-label">Total XP</div>
                        <div class="xp-value" id="totalXP">0</div>
                        <div class="xp-bar">
                            <div class="xp-fill" id="xpFill"></div>
                        </div>
                    </div>
                    <div class="badges-display">
                        <div class="badge" id="badge1" title="DC Master">
                            <span class="badge-icon">‚ö°</span>
                        </div>
                        <div class="badge" id="badge2" title="AC Expert">
                            <span class="badge-icon">‚àø</span>
                        </div>
                        <div class="badge" id="badge3" title="Digital Pro">
                            <span class="badge-icon">üî≤</span>
                        </div>
                        <div class="badge" id="badge4" title="Module Complete">
                            <span class="badge-icon">üèÜ</span>
                        </div>
                    </div>
                </div>
            </header>

          

            <!-- Progress Tracker -->
            <div class="progress-tracker">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-stats">
                    <div class="stat">Completed: <span id="completedCount">0</span>/4</div>
                    <div class="stat">Progress: <span id="progressPercent">0%</span></div>
                    <div class="stat">Time Invested: <span id="timeInvested">0h 0m</span></div>
                    <div class="stat">Next Level: <span id="nextLevel">500 XP</span></div>
                </div>
            </div>

            <!-- Lessons Grid -->
            <div class="lessons-grid">
                <!-- Lesson 1 -->
                <div class="lesson-card" data-lesson="1" data-url="https://www.aceavionicstraining.com/principles-of-direct-current">
                    <div class="lesson-number">01</div>
                    <div class="lesson-status status-available">
                        <span>‚ö°</span> AVAILABLE
                    </div>
                    <svg class="lesson-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="30" cy="50" r="15" fill="none" stroke="#ffcc00" stroke-width="2"/>
                        <circle cx="70" cy="50" r="15" fill="none" stroke="#ffcc00" stroke-width="2"/>
                        <line x1="45" y1="50" x2="55" y2="50" stroke="#ffcc00" stroke-width="2"/>
                        <text x="30" y="55" text-anchor="middle" fill="#ffcc00" font-size="12">+</text>
                        <text x="70" y="55" text-anchor="middle" fill="#ffcc00" font-size="12">-</text>
                    </svg>
                    <h3 class="lesson-title">Fundamentals of Direct Current</h3>
                    <p class="lesson-description">Master the principles of DC circuits, Ohm's Law, series and parallel circuits, and power calculations essential for avionics troubleshooting.</p>
                    <div class="lesson-meta">
                        <div class="lesson-info">
                            <span class="lesson-duration">‚è± 2h 15m</span>
                            <span class="lesson-xp">üéÆ 100 XP</span>
                        </div>
                        <button class="lesson-action" onclick="startLesson(1)">START</button>
                    </div>
                </div>

                <!-- Lesson 2 -->
                <div class="lesson-card" data-lesson="2" data-url="https://PLACEHOLDER_URL_FOR_AC_FUNDAMENTALS">
                    <div class="lesson-number">02</div>
                    <div class="lesson-status status-locked">
                        <span>üîí</span> LOCKED
                    </div>
                    <svg class="lesson-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M 20,50 Q 35,30 50,50 T 80,50" fill="none" stroke="#666" stroke-width="2"/>
                        <path d="M 20,50 Q 35,70 50,50 T 80,50" fill="none" stroke="#666" stroke-width="2"/>
                    </svg>
                    <h3 class="lesson-title">Fundamentals of Alternating Current</h3>
                    <p class="lesson-description">Explore AC waveforms, frequency, phase relationships, transformers, and three-phase systems used in modern aircraft electrical systems.</p>
                    <div class="lesson-meta">
                        <div class="lesson-info">
                            <span class="lesson-duration">‚è± 2h 30m</span>
                            <span class="lesson-xp">üéÆ 120 XP</span>
                        </div>
                        <button class="lesson-action" disabled>LOCKED</button>
                    </div>
                </div>

                <!-- Lesson 3 -->
                <div class="lesson-card" data-lesson="3" data-url="https://PLACEHOLDER_URL_FOR_SOLID_STATE_DEVICES">
                    <div class="lesson-number">03</div>
                    <div class="lesson-status status-locked">
                        <span>üîí</span> LOCKED
                    </div>
                    <svg class="lesson-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <rect x="35" y="30" width="30" height="40" fill="none" stroke="#666" stroke-width="2"/>
                        <polyline points="35,40 25,40 25,60 35,60" fill="none" stroke="#666" stroke-width="2"/>
                        <polyline points="65,40 75,40 75,60 65,60" fill="none" stroke="#666" stroke-width="2"/>
                        <circle cx="50" cy="50" r="3" fill="#666"/>
                    </svg>
                    <h3 class="lesson-title">Solid State Devices</h3>
                    <p class="lesson-description">Understand diodes, transistors, integrated circuits, and their applications in avionics systems including power supplies and amplifiers.</p>
                    <div class="lesson-meta">
                        <div class="lesson-info">
                            <span class="lesson-duration">‚è± 2h 00m</span>
                            <span class="lesson-xp">üéÆ 100 XP</span>
                        </div>
                        <button class="lesson-action" disabled>LOCKED</button>
                    </div>
                </div>

                <!-- Lesson 4 -->
                <div class="lesson-card" data-lesson="4" data-url="https://PLACEHOLDER_URL_FOR_DIGITAL_ELECTRONICS">
                    <div class="lesson-number">04</div>
                    <div class="lesson-status status-locked">
                        <span>üîí</span> LOCKED
                    </div>
                    <svg class="lesson-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <rect x="20" y="35" width="60" height="30" fill="none" stroke="#666" stroke-width="2"/>
                        <text x="50" y="45" text-anchor="middle" fill="#666" font-size="8">10110101</text>
                        <text x="50" y="57" text-anchor="middle" fill="#666" font-size="8">01001010</text>
                        <circle cx="15" cy="50" r="2" fill="#666"/>
                        <circle cx="85" cy="50" r="2" fill="#666"/>
                    </svg>
                    <h3 class="lesson-title">Digital Electronics & Databus Systems</h3>
                    <p class="lesson-description">Master digital logic, ARINC 429, MIL-STD-1553, and modern databus architectures critical for troubleshooting avionics communication systems.</p>
                    <div class="lesson-meta">
                        <div class="lesson-info">
                            <span class="lesson-duration">‚è± 1h 45m</span>
                            <span class="lesson-xp">üéÆ 80 XP</span>
                        </div>
                        <button class="lesson-action" disabled>LOCKED</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CAET LMS - ENHANCED PROGRESS TRACKING SYSTEM
        // ==========================================
        // This system tracks actual user interaction with lesson content
        // including time spent, scroll depth, and click interactions
        
        // LMS State Management - Enhanced Schema
        const lmsState = {
            profile: {
                name: 'CAET Student',
                level: 1,
                totalXP: 0,
                avatar: 'üë®‚Äç‚úàÔ∏è',
                joinDate: new Date().toISOString(),
                lastActive: new Date().toISOString()
            },
            lessons: {
                1: {
                    completed: false,
                    progress: 0,
                    xp: 100,
                    duration: 135,
                    url: 'https://www.aceavionicstraining.com/principles-of-direct-current',
                    timeSpent: 0,
                    scrollDepth: 0,
                    objectives: [
                        { name: "Ohm's Law", completed: false, score: 0 },
                        { name: "Series Circuits", completed: false, score: 0 },
                        { name: "Parallel Circuits", completed: false, score: 0 },
                        { name: "Power Calculations", completed: false, score: 0 }
                    ],
                    topicScores: {
                        dc_theory: 0,
                        circuit_analysis: 0,
                        problem_solving: 0,
                        troubleshooting: 0
                    }
                },
                2: {
                    completed: false,
                    progress: 0,
                    xp: 120,
                    duration: 150,
                    url: 'https://PLACEHOLDER_URL_FOR_AC_FUNDAMENTALS',
                    timeSpent: 0,
                    scrollDepth: 0,
                    objectives: [
                        { name: "AC Waveforms", completed: false, score: 0 },
                        { name: "Frequency & Phase", completed: false, score: 0 },
                        { name: "Transformers", completed: false, score: 0 },
                        { name: "Three-Phase Systems", completed: false, score: 0 }
                    ],
                    topicScores: {
                        ac_theory: 0,
                        transformers: 0,
                        phase_systems: 0,
                        power_distribution: 0
                    }
                },
                3: {
                    completed: false,
                    progress: 0,
                    xp: 100,
                    duration: 120,
                    url: 'https://PLACEHOLDER_URL_FOR_SOLID_STATE_DEVICES',
                    timeSpent: 0,
                    scrollDepth: 0,
                    objectives: [
                        { name: "Diodes", completed: false, score: 0 },
                        { name: "Transistors", completed: false, score: 0 },
                        { name: "Integrated Circuits", completed: false, score: 0 },
                        { name: "Power Supplies", completed: false, score: 0 }
                    ],
                    topicScores: {
                        semiconductors: 0,
                        amplifiers: 0,
                        power_supplies: 0,
                        applications: 0
                    }
                },
                4: {
                    completed: false,
                    progress: 0,
                    xp: 80,
                    duration: 105,
                    url: 'https://PLACEHOLDER_URL_FOR_DIGITAL_ELECTRONICS',
                    timeSpent: 0,
                    scrollDepth: 0,
                    objectives: [
                        { name: "Digital Logic", completed: false, score: 0 },
                        { name: "ARINC 429", completed: false, score: 0 },
                        { name: "MIL-STD-1553", completed: false, score: 0 },
                        { name: "Databus Systems", completed: false, score: 0 }
                    ],
                    topicScores: {
                        digital_logic: 0,
                        databus_protocols: 0,
                        troubleshooting: 0,
                        systems_integration: 0
                    }
                }
            },
            badges: {
                1: false,  // DC Master
                2: false,  // AC Expert
                3: false,  // Digital Pro
                4: false   // Module Complete
            },
            stats: {
                totalTime: 0,
                streak: 0,
                lastStudyDate: null,
                lessonsCompleted: 0
            },
            currentLesson: null,
            lessonStartTime: null
        };

        // Progress Tracking Variables
        let progressTimer = null;
        let timeInLesson = 0;
        let scrollProgress = 0;
        let clickInteractions = 0;
        const MIN_TIME_FOR_CREDIT = 30; // Minimum 30 seconds in lesson
        const PROGRESS_INCREMENT_TIME = 2; // Increment progress every 2 seconds
        
        // Load saved state from localStorage
        function loadState() {
            const saved = localStorage.getItem('caetLMSState');
            if (saved) {
                const savedState = JSON.parse(saved);
                Object.assign(lmsState, savedState);
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('caetLMSState', JSON.stringify(lmsState));
        }

        // Initialize the application
        function init() {
            loadState();
            updateUI();

            // Setup postMessage listener for lesson tracking
            setupPostMessageListener();

            // Setup fullscreen change listener
            setupFullscreenListener();

            // Open hangar doors after load
            setTimeout(() => {
                document.getElementById('hangarDoors').classList.add('doors-open');
            }, 500);

            // Hide doors completely after animation
            setTimeout(() => {
                document.getElementById('hangarDoors').style.display = 'none';
            }, 1700);
        }

        // Setup postMessage listener for cross-window communication
        function setupPostMessageListener() {
            window.addEventListener('message', (event) => {
                // Security check (in production, verify event.origin)
                if (!event.data || event.data.source !== 'caet-lesson-tracker') {
                    return;
                }

                const message = event.data;
                console.log('üìä Received from lesson:', message.type);

                switch (message.type) {
                    case 'TRACKER_READY':
                        console.log(`‚úÖ Tracker ready for lesson: ${message.lessonId}`);
                        break;

                    case 'PROGRESS_UPDATE':
                        handleProgressUpdate(message);
                        break;

                    case 'LESSON_COMPLETED':
                        handleLessonCompleted(message);
                        break;

                    case 'VIDEO_STARTED':
                        console.log(`‚ñ∂Ô∏è Video started in lesson ${message.lessonId}`);
                        break;

                    case 'VIDEO_COMPLETED':
                        console.log(`‚úÖ Video completed in lesson ${message.lessonId}`);
                        break;

                    case 'FULLSCREEN_CHANGED':
                        console.log(`üñ•Ô∏è Fullscreen: ${message.isFullscreen}`);
                        break;

                    default:
                        console.log('Unknown message type:', message.type);
                }
            });
        }

        // Handle progress update from lesson tracker
        function handleProgressUpdate(message) {
            if (!message.lessonId || !lmsState.lessons[message.lessonId]) {
                return;
            }

            const lessonData = lmsState.lessons[message.lessonId];
            const updateData = message.data;

            // Update lesson progress
            lessonData.progress = updateData.progress;
            lessonData.timeSpent = Math.floor(updateData.activeTime / 60); // Convert to minutes
            lessonData.scrollDepth = updateData.scrollDepth;

            // Update objectives if provided
            if (updateData.objectives && updateData.objectives.length > 0) {
                updateData.objectives.forEach(obj => {
                    const existing = lessonData.objectives.find(o => o.name === obj.name);
                    if (existing) {
                        existing.completed = obj.completed;
                        existing.score = obj.score;
                    }
                });
            }

            // Update topic scores if provided
            if (updateData.topicProgress) {
                Object.keys(updateData.topicProgress).forEach(topic => {
                    if (lessonData.topicScores.hasOwnProperty(topic)) {
                        lessonData.topicScores[topic] = updateData.topicProgress[topic];
                    }
                });
            }

            // Update quiz scores if provided
            if (updateData.quizScores) {
                lessonData.quizScores = updateData.quizScores;
            }

            // Update stats
            lmsState.stats.totalTime = Math.floor(updateData.activeTime / 60);
            lmsState.profile.lastActive = new Date().toISOString();

            // Update UI
            document.getElementById('lessonProgress').textContent = Math.round(lessonData.progress) + '%';

            // Save state
            saveState();

            // Check for completion
            if (lessonData.progress >= 100 && !lessonData.completed) {
                checkLessonCompletion(message.lessonId);
            }
        }

        // Handle lesson completion from tracker
        function handleLessonCompleted(message) {
            if (!message.lessonId || !lmsState.lessons[message.lessonId]) {
                return;
            }

            const lessonData = lmsState.lessons[message.lessonId];

            // Update with final data
            if (message.data) {
                lessonData.timeSpent = Math.floor(message.data.activeTime / 60);
                lessonData.scrollDepth = message.data.scrollDepth;

                if (message.data.objectives) {
                    message.data.objectives.forEach(obj => {
                        const existing = lessonData.objectives.find(o => o.name === obj.name);
                        if (existing) {
                            existing.completed = obj.completed;
                            existing.score = obj.score;
                        }
                    });
                }

                if (message.data.topicProgress) {
                    Object.keys(message.data.topicProgress).forEach(topic => {
                        if (lessonData.topicScores.hasOwnProperty(topic)) {
                            lessonData.topicScores[topic] = message.data.topicProgress[topic];
                        }
                    });
                }
            }

            // Mark as completed
            checkLessonCompletion(message.lessonId);
        }

        // Setup fullscreen change listener
        function setupFullscreenListener() {
            document.addEventListener('fullscreenchange', () => {
                const modal = document.getElementById('lessonModal');
                if (!document.fullscreenElement && modal.classList.contains('active')) {
                    // User exited fullscreen, show modal controls
                    console.log('Exited fullscreen');
                }
            });
        }

        // Update the UI based on current state
        function updateUI() {
            // Update XP display
            document.getElementById('totalXP').textContent = lmsState.profile.totalXP;

            // Update XP bar
            const xpForNextLevel = (lmsState.profile.level * 500);
            const currentLevelXP = ((lmsState.profile.level - 1) * 500);
            const xpProgress = ((lmsState.profile.totalXP - currentLevelXP) / (xpForNextLevel - currentLevelXP)) * 100;
            document.getElementById('xpFill').style.width = xpProgress + '%';
            document.getElementById('nextLevel').textContent = xpForNextLevel + ' XP';

            // Update badges
            Object.keys(lmsState.badges).forEach(badgeNum => {
                const badge = document.getElementById(`badge${badgeNum}`);
                if (lmsState.badges[badgeNum]) {
                    badge.classList.add('earned');
                } else {
                    badge.classList.remove('earned');
                }
            });

            // Update overall progress
            const totalLessons = Object.keys(lmsState.lessons).length;
            const completedLessons = Object.values(lmsState.lessons).filter(l => l.completed).length;
            const overallProgress = Math.round((completedLessons / totalLessons) * 100);

            document.getElementById('completedCount').textContent = completedLessons;
            document.getElementById('progressPercent').textContent = overallProgress + '%';
            document.getElementById('progressBar').style.width = overallProgress + '%';

            // Update time invested
            const hours = Math.floor(lmsState.stats.totalTime / 60);
            const minutes = lmsState.stats.totalTime % 60;
            document.getElementById('timeInvested').textContent = `${hours}h ${minutes}m`;

            // Update lesson cards
            document.querySelectorAll('.lesson-card').forEach(card => {
                const lessonNum = parseInt(card.dataset.lesson);
                const lessonData = lmsState.lessons[lessonNum];
                const status = card.querySelector('.lesson-status');
                const button = card.querySelector('.lesson-action');
                const icon = card.querySelector('.lesson-icon');

                if (lessonData.completed) {
                    status.className = 'lesson-status status-completed';
                    status.innerHTML = '<span>‚úì</span> COMPLETED';
                    button.textContent = 'REVIEW';
                    button.disabled = false;
                    updateIconColor(icon, '#00ff41');
                } else if (lessonData.progress > 0 && lessonData.progress < 100) {
                    status.className = 'lesson-status status-in-progress';
                    status.innerHTML = `<span>‚ñ∂</span> ${Math.round(lessonData.progress)}%`;
                    button.textContent = 'CONTINUE';
                    button.disabled = false;
                    updateIconColor(icon, '#ff6600');
                } else if (lessonNum === 1 || lmsState.lessons[lessonNum - 1].completed) {
                    status.className = 'lesson-status status-available';
                    status.innerHTML = '<span>‚ö°</span> AVAILABLE';
                    button.textContent = 'START';
                    button.disabled = false;
                    updateIconColor(icon, '#ffcc00');
                } else {
                    status.className = 'lesson-status status-locked';
                    status.innerHTML = '<span>üîí</span> LOCKED';
                    button.textContent = 'LOCKED';
                    button.disabled = true;
                    updateIconColor(icon, '#666');
                }
            });
        }

        // Update icon colors
        function updateIconColor(icon, color) {
            icon.querySelectorAll('*').forEach(el => {
                if (el.hasAttribute('stroke')) el.setAttribute('stroke', color);
                if (el.hasAttribute('fill') && el.getAttribute('fill') !== 'none') {
                    el.setAttribute('fill', color);
                }
            });
        }

        // Start lesson
        function startLesson(lessonNum) {
            const card = document.querySelector(`[data-lesson="${lessonNum}"]`);
            const url = card.dataset.url;
            const title = card.querySelector('.lesson-title').textContent;
            
            if (url === '#') {
                alert('Lesson content not yet available. This is a demo.');
                return;
            }
            
            lmsState.currentLesson = lessonNum;
            lmsState.lessonStartTime = Date.now();
            lmsState.lessonInteractions = 0;
            timeInLesson = 0;
            scrollProgress = 0;
            clickInteractions = 0;
            
            openLessonModal(lessonNum, title, url);
            
            // Start tracking progress with real interaction
            if (!lmsState.lessons[lessonNum].completed) {
                startEnhancedProgressTracking(lessonNum);
            }
        }

        // Open lesson modal
        function openLessonModal(lessonNum, title, url) {
            const modal = document.getElementById('lessonModal');
            const iframe = document.getElementById('lessonFrame');
            const loading = document.getElementById('iframeLoading');
            const modalContainer = modal.querySelector('.modal-container');

            document.getElementById('modalTitle').textContent = title;
            document.getElementById('lessonProgress').textContent = Math.round(lmsState.lessons[lessonNum].progress) + '%';

            modal.classList.add('active');
            loading.style.display = 'block';

            // Load the lesson in iframe
            iframe.onload = () => {
                loading.style.display = 'none';
                // Try to enter fullscreen mode
                requestFullscreen(modalContainer);
            };
            iframe.src = url;
        }

        // Request fullscreen for element
        function requestFullscreen(element) {
            if (element.requestFullscreen) {
                element.requestFullscreen().catch(err => {
                    console.warn('Could not enter fullscreen:', err);
                });
            } else if (element.webkitRequestFullscreen) {
                // Safari
                element.webkitRequestFullscreen();
            } else if (element.mozRequestFullScreen) {
                // Firefox
                element.mozRequestFullScreen();
            } else if (element.msRequestFullscreen) {
                // IE11
                element.msRequestFullscreen();
            }
        }

        // Exit fullscreen
        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        // Enhanced Progress Tracking System
        function startEnhancedProgressTracking(lessonNum) {
            // Clear any existing timer
            if (progressTimer) {
                clearInterval(progressTimer);
            }
            
            // Track time-based progress
            progressTimer = setInterval(() => {
                if (lmsState.currentLesson !== lessonNum) {
                    clearInterval(progressTimer);
                    return;
                }
                
                timeInLesson += PROGRESS_INCREMENT_TIME;
                
                // Calculate progress based on multiple factors
                let progressIncrease = 0;
                
                // Time-based progress (max 60% from time)
                if (timeInLesson >= MIN_TIME_FOR_CREDIT) {
                    progressIncrease = Math.min(2, (timeInLesson / 30)); // Slower progress rate
                }
                
                // Interaction bonus (max 20% from interactions)
                if (clickInteractions > 0) {
                    progressIncrease += Math.min(1, clickInteractions * 0.1);
                    clickInteractions = 0; // Reset after counting
                }
                
                // Update progress
                if (lmsState.lessons[lessonNum].progress < 100) {
                    lmsState.lessons[lessonNum].progress = Math.min(100, 
                        lmsState.lessons[lessonNum].progress + progressIncrease);
                    
                    document.getElementById('lessonProgress').textContent = 
                        Math.round(lmsState.lessons[lessonNum].progress) + '%';
                    
                    // Add time to total
                    lmsState.totalTime += PROGRESS_INCREMENT_TIME / 60; // Convert to minutes
                    
                    saveState();
                    
                    // Check for completion
                    if (lmsState.lessons[lessonNum].progress >= 100) {
                        checkLessonCompletion(lessonNum);
                    }
                }
            }, PROGRESS_INCREMENT_TIME * 1000); // Check every 2 seconds
        }

        // Track iframe interactions (limited by cross-origin policy)
        function trackIframeInteraction() {
            // Track clicks on the modal (since we can't access iframe content)
            const modal = document.getElementById('lessonModal');
            modal.addEventListener('click', (e) => {
                if (!e.target.classList.contains('modal-close')) {
                    clickInteractions++;
                }
            });
        }

        // Close lesson modal
        function closeLessonModal() {
            const modal = document.getElementById('lessonModal');
            const iframe = document.getElementById('lessonFrame');

            // Exit fullscreen if active
            if (document.fullscreenElement) {
                exitFullscreen();
            }

            // Clear progress timer
            if (progressTimer) {
                clearInterval(progressTimer);
                progressTimer = null;
            }

            modal.classList.remove('active');
            iframe.src = '';

            // Calculate time spent
            if (lmsState.lessonStartTime) {
                const timeSpent = Math.round((Date.now() - lmsState.lessonStartTime) / 1000 / 60); // minutes
                lmsState.stats.totalTime += timeSpent;
                lmsState.lessonStartTime = null;
            }

            // Check if lesson was completed
            if (lmsState.currentLesson) {
                checkLessonCompletion(lmsState.currentLesson);
            }

            lmsState.currentLesson = null;
            lmsState.profile.lastActive = new Date().toISOString();
            saveState();
            updateUI();
        }

        // Check lesson completion
        function checkLessonCompletion(lessonNum) {
            const lesson = lmsState.lessons[lessonNum];
            
            if (lesson.progress >= 100 && !lesson.completed) {
                lesson.completed = true;
                lesson.progress = 100;
                
                // Award XP
                awardXP(lesson.xp);
                
                // Check for badge awards
                checkBadges(lessonNum);
                
                // Save and update
                saveState();
                updateUI();
            }
        }

        // Award XP with notification
        function awardXP(amount) {
            lmsState.profile.totalXP += amount;

            // Check for level up
            const newLevel = Math.floor(lmsState.profile.totalXP / 500) + 1;
            if (newLevel > lmsState.profile.level) {
                lmsState.profile.level = newLevel;
                // Could show level up notification here
                console.log(`üéâ Level Up! You are now level ${newLevel}`);
            }

            // Update stats
            lmsState.stats.lessonsCompleted = Object.values(lmsState.lessons).filter(l => l.completed).length;

            // Show XP notification
            showXPNotification(amount);
        }

        // Show XP notification
        function showXPNotification(amount) {
            const notification = document.getElementById('xpNotification');
            document.getElementById('xpAmount').textContent = amount;
            
            notification.style.display = 'block';
            notification.style.animation = 'xp-pop 0.5s ease forwards';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }

        // Check for badge awards
        function checkBadges(lessonNum) {
            // Award lesson-specific badge
            if (lessonNum === 1 && !lmsState.badges[1]) {
                lmsState.badges[1] = true;
                showBadgeUnlock('DC Master');
            } else if (lessonNum === 2 && !lmsState.badges[2]) {
                lmsState.badges[2] = true;
                showBadgeUnlock('AC Expert');
            } else if (lessonNum === 3 && !lmsState.badges[3]) {
                lmsState.badges[3] = true;
                showBadgeUnlock('Digital Pro');
            }
            
            // Check for module completion badge
            const allComplete = Object.values(lmsState.lessons).every(l => l.completed);
            if (allComplete && !lmsState.badges[4]) {
                lmsState.badges[4] = true;
                showBadgeUnlock('Module Complete');
            }
        }

        // Show badge unlock notification
        function showBadgeUnlock(badgeName) {
            console.log(`üèÜ Badge Unlocked: ${badgeName}`);
            // You could add a visual notification here
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && lmsState.currentLesson) {
                closeLessonModal();
            } else if (e.key >= '1' && e.key <= '4' && !lmsState.currentLesson) {
                const lessonNum = parseInt(e.key);
                const button = document.querySelector(`[data-lesson="${lessonNum}"] .lesson-action`);
                if (button && !button.disabled) {
                    button.click();
                }
            }
        });

        // CRT glitch effect
        setInterval(() => {
            if (Math.random() > 0.95) {
                document.querySelector('.crt-container').style.animation = 'glitch 0.1s';
                setTimeout(() => {
                    document.querySelector('.crt-container').style.animation = '';
                }, 100);
            }
        }, 3000);

        // Add glitch keyframe
        const style = document.createElement('style');
        style.textContent = `
            @keyframes glitch {
                0% { transform: translate(0); }
                20% { transform: translate(-2px, 2px); }
                40% { transform: translate(-2px, -2px); }
                60% { transform: translate(2px, 2px); }
                80% { transform: translate(2px, -2px); }
                100% { transform: translate(0); }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
